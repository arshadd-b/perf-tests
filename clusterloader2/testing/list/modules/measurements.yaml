## Measurement module defines test scoped measurement.

## Input params
# Valid actions: "start", "gather"
{{$action := .action}}
{{$ENABLE_CONTAINER_MEMORY_USAGE_MEASUREMENT := DefaultParam .CL2_ENABLE_CONTAINER_MEMORY_USAGE_MEASUREMENT true}}
{{$CONTAINER_MEMORY_THRESHOLD := DefaultParam .CL2_CONTAINER_MEMORY_THRESHOLD 1}}


steps:
- name: "{{$action}}ing measurements"
  measurements:
  - Identifier: APIResponsivenessPrometheusSimple
    Method: APIResponsivenessPrometheus
    Params:
      action: {{$action}}
      enableViolations: false
      useSimpleLatencyQuery: true
  - Identifier: TestMetrics
    Method: TestMetrics
    Params:
      action: {{$action}}
  {{if $ENABLE_CONTAINER_MEMORY_USAGE_MEASUREMENT}}
  - Identifier: ContainerMemoryUsage
    Method: ContainerMemoryUsage
    Params:
      action: {{$action}}
      threshold: {{$CONTAINER_MEMORY_THRESHOLD}}
      pollFrequency: 15s
  {{end}}